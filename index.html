<!DOCTYPE html PUBLIC "*"> 
<html>
<head>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js" type="text/javascript"></script>
	<script src="lib/raphael.js" type="text/javascript"></script>
	<script type="text/javascript">

	var Vector2D = function (x, y) {
		this.x = x;
		this.y = y;
	};

	$(function () {
		var width = 320,
			height = 200,
			paper = Raphael('control', width, height),
			blotter = paper.rect(0, 0, width, height),
			focusPoints = paper.set(),
			focusPoint_radius = 5,
			focusPoint_diameter = focusPoint_radius*2;
		
		function centerCoords(x, y) {
			x -= focusPoint_radius;
			y -= focusPoint_radius;
			return new Vector2D(x,y);
		}

		function checkBounds(v, rect) {
			var top		= v.y < (rect.attr('y')),
				right	= v.x > (rect.attr('x') + rect.attr('width')),
				bottom	= v.y > (rect.attr('y') + rect.attr('height')),
				left	= v.x < (rect.attr('x')),
				validbounds	= {top: !top, right: !right, bottom: !bottom, left: !left};
			console.log(rect.attr('y') + rect.attr('height'));
			return validbounds;
		}

		function dblclick(ev) {
			var v = relativeVector(ev.pageX, ev.pageY, blotter.node);
			addFocusPoint(v);
			console.log(v);
			// add to gradient colors & recalculate
		}
		
		function drag(dx, dy, x, y) {
			var v = relativeVector(x, y, blotter.node),
				v = centerCoords(v.x, v.y),
				validbounds = checkBounds(v, blotter);
			if(validbounds.left && validbounds.right) {
				this.animate({'cx': v.x}, 100);
			} else {
				this.animate({'cx': this.attr('cx')}, 100);
			}
			if(validbounds.top && validbounds.bottom) {
				this.animate({'cy': v.y}, 100);
			} else {
				this.animate({'cy': this.attr('cy')}, 100);	
			}
		}
		
		function addFocusPoint(v) {
			var v = centerCoords(v.x, v.y),
				focusPoint = paper.circle(v.x, v.y, focusPoint_radius)
				.attr('fill', '#999999')
				.attr('stroke', '#000');
			focusPoint.drag(drag);
			focusPoints.push(focusPoint);
		}

		function relativeVector(x, y, node) {
			x = x - $(document).scrollLeft() - $(node).offset().left;
			y = y - $(document).scrollTop() - $(node).offset().top;
			return new Vector2D(x, y);
		}
		// create the context and a blotter for the points
		blotter.attr('fill', '#ffffff');
		blotter.attr('stroke', '#000000');
		blotter.dblclick(dblclick);
		
	});
	</script>
	<style>
	#control{
		margin: 0 auto;
	}
	</style>
</head>
<body>
	<div id='control'></div>
</body>
</html>